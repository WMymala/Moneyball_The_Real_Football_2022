---
title: "Moneyball Soccer Group"
author: "Moneyball Soccer Group: Harry Kim, Hugo Moncada, Alexa Aguirre, Eric Sun, Thomas Venner, Walter Mymala"
date: "3/30/2022"
output:
  html_document:
    df_print: paged
---

This data of international data was collected between February 16th, 2022 and April 23, 2022. Thank you Harry Kim for filling out most of the data and finishing in April. Please not that data is constantly changing through time, and our data should be most representative of national team setups based on November 2021 and data based on April 2022. 

Question: How much influence does international caps have on player value based on the best 6 teams in Europe? 

We chose only European teams and independent variables due to regional/cultural similarities and convenience.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


```{r, message=FALSE}
MoneyballData = read.csv("Moneyball Soccer Dataset.csv")
names(MoneyballData) = c("Players","Nationality","Club","Position","Age","Value","Wage","Caps")
attach(MoneyballData)
MoneyballData[9:13] <- list(NULL)
 MoneyballData <- MoneyballData[-c(152:183), ]
 MoneyballData <- MoneyballData %>% 
  arrange(Nationality, factor(Position, levels = c('FW', 'MF', 'DF', 'GK')))
```



* Players - Player name (First Last)

* Nationality - Country that a player plays for internationally through FIFA

* Club - Team that a player plays for 

* Position - The primary position of a player: goalkeeper (GK), defender (DF), midfielder (MF), or forward (FW)

* Age - How old a player is at the time of taking our data

* Position - What a player should theoretically sell for in the transfer market if another team wanted to buy the player based on transfermarkt.us (in € and in millions). Value is primarily based on a player's age, potential, skill, in-game performance, and much more. For more detail on how transfermarkt determines value, read https://www.transfermarkt.co.in/transfermarkt-market-value-explained-how-is-it-determined-/view/news/385100.

* Wage - Amount of money a player earns (in € and in thousands) via salarysport.com. 

* Caps - Amount of international games a player has played for their country (only applies if player participates in the game and does not count if they just get called up and sits on the bench)

In order to check whether we can use linear regression for our data, we need to check some assumptions (will learn these in STA 141): https://www.godatadrive.com/blog/basic-guide-to-test-assumptions-of-linear-regression-in-r


```{r,warning=FALSE}
# Dot Plot to see Equal Variance (value, wage and caps)

# age
plot <- ggplot(MoneyballData, aes(x=Nationality, y=Age, fill = Nationality)) + scale_fill_manual(values=c("#FDDA24", "#FFFFFF", "#0072BB", "#000000", "#007CC3", "#E60026")) +
  geom_dotplot(binaxis='y', stackdir='center', binwidth = 1) + stat_summary(fun=median, geom="point", shape=18,
                 size=5, color="pink")
plot

# wage
plot <- ggplot(MoneyballData, aes(x=Nationality, y=Wage, fill = Nationality)) + scale_fill_manual(values=c("#FDDA24", "#FFFFFF", "#0072BB", "#000000", "#007CC3", "#E60026")) +
  geom_dotplot(binaxis='y', stackdir='center', binwidth = 13) + stat_summary(fun=median, geom="point", shape=18,
                 size=5, color="pink")
plot

# caps
plot <- ggplot(MoneyballData, aes(x=Nationality, y=Caps, fill = Nationality)) + scale_fill_manual(values=c("#FDDA24", "#FFFFFF", "#0072BB", "#000000", "#007CC3", "#E60026")) +
  geom_dotplot(binaxis='y', stackdir='center', binwidth = 6) + stat_summary(fun=median, geom="point", shape=18,
                 size=5, color="pink")
plot
```

We see that the variances of the factor level means look a little similar for each variable. While given small number of observations, the variation in the dotplots of each group's observations seems similar (might be randomness). 

```{r}
attach(MoneyballData)
modelall <- lm(Value ~ Age + Wage + Caps)
summary(modelall)
par(mfrow=c(2,2))
plot(modelall) # Pattern in residual plot (Larger variance as fitted gets larger) but residual errors have mean value of zero, Normally distributed based on Q-Q plot, Errors have constant variance based on Scale-Location. Mbappe looks like a high leverage point based on Residuals vs Leverage.
```

```{r}
modelwocaps <- lm(Value ~ Age + Wage)
summary(modelwocaps)
par(mfrow=c(2,2))
plot(modelwocaps) # same conclusions as modelall
```

```{r}
modelcaps <- lm(Value ~ Caps)
summary(modelcaps)
par(mfrow=c(2,2))
plot(modelcaps) # bad Residuals vs. Fitted (Pattern in residual plot (smaller variance as fitted gets larger and residual errors have mean value not zero)
```

```{r}
# correlation matrix
library(psych)
pairs.panels(MoneyballData[4:8])
```

Conclusion: It's hard to determine if there is statistically significant correlation between player value and international caps and the linear regression models we tried determined that caps are not all that important to determining player value for the best 6 teams in Europe. We can see that through our linear regressions. The caps variable in modelall shows that the caps variable isn't statistically significant since it has 0 stars in the summary function and the $R^2$ of modelcaps is very low.

For example, Marc-Andre ter Stegen, German goalkeeper that has
kept the goal for Barcelona over five years hasn’t consistently represented Germany due to his competition, Manuel Neuer, one of the finest goalkeepers of our generation. ter Stegen, who at
the age of 29, has just begun getting regular appearances with Die Mannschaft, has substantially less international caps compared to Neuer who has accumulated 109 caps, making entrance into the elite century club. At the age of 36, Neuer is still considered one of the
best goalkeepers in the world. Player value doesn’t have to be related to international caps, although in some cases, correlation may seem to be existent. In addition, there are lots of
factors that go into determining a player’s value, one of which may be the player’s international caps, believe it or not. It may be a better idea to use international caps as one of many predictor variables to determine a player’s value.

**Add ggplots of how positions and nationality affect player value!!**


